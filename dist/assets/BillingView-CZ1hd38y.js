import{d as re,r as v,x as c,i as ie,j as de,c as i,o as d,k as G,a as t,w as V,b as N,v as B,y as p,E as ue,t as a,e as u,F,B as W}from"./index-COqVfnXd.js";import{_ as be}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cce2uIDO.js";import{_ as ve}from"./ClientActions.vue_vue_type_script_setup_true_lang-Bsi_lvWs.js";import{c as pe}from"./api-DJGMUGZv.js";import{l as ce}from"./http-CfBk4xsK.js";async function xe(){const k=await ce();return pe(k.api_url)}async function me(k,r,f,s){var l;const x=await xe();let L;for(const D of r)try{let m;return k==="get"&&({data:m}=await x.get(D,{params:s})),m}catch(m){L=m;const I=(l=m==null?void 0:m.response)==null?void 0:l.status;if(I!==404&&I!==405)throw m}throw L}async function fe(k){const r=await me("get",["webadmin/faturamento","webadmin/faturamentos","webadmin/billing","webadmin/faturas"],null,k);return Array.isArray(r)?r:(r==null?void 0:r.data)||(r==null?void 0:r.rows)||[]}const ge={class:"mb-6 flex items-center justify-between gap-3"},ke={class:"card p-4"},ye={class:"flex flex-wrap items-center gap-4"},ze={class:"relative flex-1 min-w-[280px]"},we={class:"relative"},Ce={class:"font-medium"},Ae={key:0,class:"absolute z-10 mt-2 w-80 bg-white dark:bg-zinc-800 rounded-lg shadow-lg border border-zinc-200 dark:border-zinc-700"},Ee={class:"p-4"},Ne={class:"flex gap-1 mb-4"},Le={key:0,class:"space-y-3"},De={key:1,class:"space-y-3"},Ie={key:2,class:"flex justify-end gap-2 mt-4"},$e={class:"mb-3 mt-3"},he={class:"flex items-center gap-2 border-b border-zinc-200 dark:border-zinc-700"},Se={class:"ml-auto flex items-center gap-2 text-sm"},Ve=["value"],Be={key:0,class:"card p-4"},Me={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"},Fe={class:"flex items-center justify-between"},Pe={class:"font-medium truncate"},Te={class:"text-xs px-2 py-0.5 rounded bg-zinc-100 dark:bg-zinc-800"},Re={class:"text-sm text-zinc-600 dark:text-zinc-300 space-y-1"},_e={class:"flex gap-2 flex-wrap"},Ue={class:"flex gap-3 flex-wrap"},je={class:"fixed w-[calc(100%-15rem)] left-60 bottom-0 z-30 bg-white dark:bg-zinc-900/90 border-t border-zinc-200 dark:border-zinc-700 p-2"},Oe={class:"container max-w-[1400px] mx-auto flex flex-col sm:flex-row sm:items-center gap-2 justify-between text-sm"},Ge={class:"mt-1 text-blue-600 text-xs font-medium me-2 px-2.5 py-0.5 rounded-sm dark:bg-blue-900 dark:text-blue-300"},We={class:"inline-flex items-center gap-1"},qe=["disabled"],Ke=["disabled"],He={key:0,class:"px-2 py-1 text-zinc-400"},Je=["onClick"],Qe=["disabled"],Xe=["disabled"],ot=re({__name:"BillingView",setup(k){const r=v(!1),f=v(""),s=v(1),x=v(18),L=v(0),l=v("todos"),D={todos:"",aguardando:"PENDING",aprovados:"APPROVED",aguardando_nf:"AWAITING_INVOICE",faturados:"BILLED",cancelados:"CANCELED"},m={PENDING:"Aguardando",APPROVED:"Aprovados",AWAITING_INVOICE:"Aguardando NF",BILLED:"Faturados",CANCELED:"Cancelados",ALL:"Todos"};function I(o){const e=String(o||"").trim();if(!e)return"-";const n=e.replace(/[-\s]+/g,"_").toUpperCase();return m[n]||e}function q(o){return String(o||"").trim().replace(/[-\s]+/g,"_").toUpperCase()}function P(o){const e=o.status??o.situacao??o.status_faturamento??o.situacao_faturamento??"";return q(e)}function z(o){return h.value.filter(e=>P(e)===o).length}const K=c(()=>h.value.length),H=c(()=>z("PENDING")),J=c(()=>z("APPROVED")),Q=c(()=>z("AWAITING_INVOICE")),X=c(()=>z("BILLED")),Y=c(()=>z("CANCELED")),$=v([]),h=c(()=>{const o=String(f.value||"").trim().toLowerCase();let e=Array.isArray($.value)?$.value:[];return o?e.filter(n=>`${n.id||""} ${n.nome||""} ${n.cliente||""} ${n.evento||""}`.toLowerCase().includes(o)):e}),w=c(()=>{const o=D[l.value];return o?h.value.filter(e=>P(e)===o):h.value}),Z=c(()=>{const o=(s.value-1)*x.value;return w.value.slice(o,o+x.value)});function ee(){f.value="",s.value=1}const C=c(()=>{const o=w.value.length;return Math.max(1,Math.ceil(o/x.value))}),te=c(()=>{const o=C.value,e=s.value,n=2;if(o<=1)return[1];const g=[];g.push(1);let j=Math.max(2,e-n),O=Math.min(o-1,e+n);j>2&&g.push("…");for(let M=j;M<=O;M++)g.push(M);return O<o-1&&g.push("…"),g.push(o),g});function ne(){s.value=1}function oe(o){x.value=Math.max(10,Number(o)||20),s.value=1}function T(o){const e=o.target;e!=null&&e.closest(".relative")||(y.value=!1)}function se(){window.print()}function ae(o){const e=Number(o);if(!isFinite(e))return"-";try{return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}catch{return String(o??"-")}}const y=v(!1),b=v("sem_filtro"),A=v(""),E=v(""),S=v("");function le(){return"por data do cadastro"}function R(){y.value=!1,U()}async function _(){r.value=!0;try{const o=new URLSearchParams;o.append("page",String(s.value)),o.append("perPage",String(x.value)),f.value&&o.append("q",f.value),b.value==="periodo"&&(A.value||E.value)?(A.value&&o.append("date_start",A.value),E.value&&o.append("date_end",E.value)):b.value==="mes"&&S.value&&o.append("month",S.value);const e=D[l.value];e&&o.append("status",e);const n=await fe(o);$.value=Array.isArray(n)?n:(n==null?void 0:n.data)||(n==null?void 0:n.rows)||[],L.value=Array.isArray(n)?n.length:(n==null?void 0:n.total)||$.value.length}finally{r.value=!1}}function U(){s.value=1,_()}return ie(()=>{document.addEventListener("click",T),_()}),de(()=>{document.removeEventListener("click",T)}),(o,e)=>(d(),i("section",null,[G(be),t("header",ge,[e[20]||(e[20]=t("h1",{class:"text-2xl font-semibold"},"Faturamento",-1)),G(ve,{onPrint:se,onCreate:()=>{},onAction:()=>{}})]),t("div",ke,[t("div",ye,[t("div",ze,[e[22]||(e[22]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"w-4 h-4 text-zinc-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>f.value=n),onKeyup:ue(U,["enter"]),onInput:ne,class:p(["w-full pl-10 py-2 border border-zinc-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-zinc-800 dark:border-zinc-600 dark:text-zinc-100",f.value?"pr-10":"pr-4"]),placeholder:"Buscar"},null,34),[[B,f.value]]),f.value?(d(),i("button",{key:0,onClick:ee,class:"absolute inset-y-0 right-0 pr-3 flex items-center text-zinc-400 hover:text-zinc-600 dark:hover:text-zinc-300",type:"button"},[...e[21]||(e[21]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):N("",!0)]),t("div",we,[t("button",{onClick:e[1]||(e[1]=n=>y.value=!y.value),class:p(["flex items-center gap-2 px-3 py-2 text-sm border border-zinc-300 rounded-lg hover:bg-zinc-50 dark:border-zinc-600 dark:hover:bg-zinc-800",{"bg-blue-50 border-blue-300 text-blue-700 dark:bg-blue-900/20 dark:border-blue-600 dark:text-blue-300":b.value!=="sem_filtro"}])},[e[23]||(e[23]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),t("span",Ce,a(le()),1),e[24]||(e[24]=t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))],2),y.value?(d(),i("div",Ae,[t("div",Ee,[e[28]||(e[28]=t("h3",{class:"text-sm font-medium text-zinc-900 dark:text-zinc-100 mb-3"},"Data do Cadastro",-1)),t("div",Ne,[t("button",{onClick:e[2]||(e[2]=n=>{b.value="sem_filtro",R()}),class:p(["px-2 py-1 text-xs rounded border transition-colors",b.value==="sem_filtro"?"border-2 border-blue-600 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"bg-white text-zinc-700 border-zinc-300 hover:bg-zinc-50 dark:bg-zinc-800 dark:text-zinc-300 dark:border-zinc-600 dark:hover:bg-zinc-700"])},"sem filtro",2),t("button",{onClick:e[3]||(e[3]=n=>b.value="periodo"),class:p(["px-2 py-1 text-xs rounded border transition-colors",b.value==="periodo"?"border-2 border-blue-600 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"bg-white text-zinc-700 border-zinc-300 hover:bg-zinc-50 dark:bg-zinc-800 dark:text-zinc-300 dark:border-zinc-600 dark:hover:bg-zinc-700"])},"Data do Cadastro",2),t("button",{onClick:e[4]||(e[4]=n=>b.value="mes"),class:p(["px-2 py-1 text-xs rounded border transition-colors",b.value==="mes"?"border-2 border-blue-600 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"bg-white text-zinc-700 border-zinc-300 hover:bg-zinc-50 dark:bg-zinc-800 dark:text-zinc-300 dark:border-zinc-600 dark:hover:bg-zinc-700"])},"mês",2)]),b.value==="periodo"?(d(),i("div",Le,[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-xs font-medium mb-1"},"Data inicial",-1)),V(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>A.value=n),type:"date",class:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-700 dark:border-zinc-600"},null,512),[[B,A.value]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-xs font-medium mb-1"},"Data final",-1)),V(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>E.value=n),type:"date",class:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-700 dark:border-zinc-600"},null,512),[[B,E.value]])])])):N("",!0),b.value==="mes"?(d(),i("div",De,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-xs font-medium mb-1"},"Mês",-1)),V(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>S.value=n),type:"month",class:"w-full px-3 py-2 border rounded-lg dark:bg-zinc-700 dark:border-zinc-600"},null,512),[[B,S.value]])])])):N("",!0),b.value!=="sem_filtro"?(d(),i("div",Ie,[t("button",{onClick:R,class:"px-3 py-1.5 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"},"aplicar"),t("button",{onClick:e[8]||(e[8]=n=>y.value=!1),class:"px-3 py-1.5 text-zinc-600 text-xs hover:bg-zinc-100 dark:text-zinc-400 dark:hover:bg-zinc-700 rounded"},"cancelar")])):N("",!0)])])):N("",!0)])])]),t("div",$e,[t("nav",he,[t("button",{onClick:e[9]||(e[9]=n=>l.value="todos"),class:p([l.value==="todos"?"border-b-2 border-blue-600 text-blue-700":"text-zinc-600","px-3 py-2 text-sm"])},[e[29]||(e[29]=u("Todos ",-1)),t("span",null,"("+a(K.value)+")",1)],2),t("button",{onClick:e[10]||(e[10]=n=>l.value="aguardando"),class:p([l.value==="aguardando"?"border-b-2 border-blue-600 text-blue-700":"text-zinc-600","px-3 py-2 text-sm"])},[e[30]||(e[30]=u("Aguardando ",-1)),t("span",null,"("+a(H.value)+")",1)],2),t("button",{onClick:e[11]||(e[11]=n=>l.value="aprovados"),class:p([l.value==="aprovados"?"border-b-2 border-blue-600 text-blue-700":"text-zinc-600","px-3 py-2 text-sm"])},[e[31]||(e[31]=u("Aprovados ",-1)),t("span",null,"("+a(J.value)+")",1)],2),t("button",{onClick:e[12]||(e[12]=n=>l.value="aguardando_nf"),class:p([l.value==="aguardando_nf"?"border-b-2 border-blue-600 text-blue-700":"text-zinc-600","px-3 py-2 text-sm"])},[e[32]||(e[32]=u("Aguardando NF ",-1)),t("span",null,"("+a(Q.value)+")",1)],2),t("button",{onClick:e[13]||(e[13]=n=>l.value="faturados"),class:p([l.value==="faturados"?"border-b-2 border-blue-600 text-blue-700":"text-zinc-600","px-3 py-2 text-sm"])},[e[33]||(e[33]=u("Faturados ",-1)),t("span",null,"("+a(X.value)+")",1)],2),t("button",{onClick:e[14]||(e[14]=n=>l.value="cancelados"),class:p([l.value==="cancelados"?"border-b-2 border-blue-600 text-blue-700":"text-zinc-600","px-3 py-2 text-sm"])},[e[34]||(e[34]=u("Cancelados ",-1)),t("span",null,"("+a(Y.value)+")",1)],2),t("div",Se,[e[36]||(e[36]=t("span",{class:"text-zinc-500"},"Exibir",-1)),t("select",{value:x.value,onChange:e[15]||(e[15]=n=>oe(n.target.value)),class:"px-2 py-1 border border-zinc-300 rounded-md text-sm dark:bg-zinc-800 dark:border-zinc-600"},[...e[35]||(e[35]=[t("option",{value:18},"18",-1),t("option",{value:36},"36",-1),t("option",{value:72},"72",-1)])],40,Ve),e[37]||(e[37]=t("span",{class:"text-zinc-500"},"por página",-1))])])]),r.value?(d(),i("div",Be,"Carregando...")):(d(),i("div",Me,[(d(!0),i(F,null,W(Z.value,n=>(d(),i("div",{key:n.id,class:"card p-4 flex flex-col gap-2"},[t("div",Fe,[t("h3",Pe,a(n.cliente||n.cliente_nome||n.nome||n.name||"—"),1),t("span",Te,a(I(n.status||n.situacao)),1)]),t("div",Re,[t("div",_e,[e[38]||(e[38]=t("span",{class:"text-xs text-zinc-500"},"RPS:",-1)),e[39]||(e[39]=u()),t("span",null,a(n.rps||n.rps_num||"-"),1),e[40]||(e[40]=t("span",{class:"text-xs text-zinc-500 ml-3"},"NF:",-1)),e[41]||(e[41]=u()),t("span",null,a(n.nota_fiscal||n.nf||"-"),1),e[42]||(e[42]=t("span",{class:"text-xs text-zinc-500 ml-3"},"Valor:",-1)),e[43]||(e[43]=u()),t("span",null,a(ae(n.valor||n.total||n.vlr)),1)]),t("div",null,[e[44]||(e[44]=t("span",{class:"text-xs text-zinc-500"},"Emissão:",-1)),u(" "+a(n.data_emissao||n.data||n.created_at||"-"),1)]),t("div",null,[e[45]||(e[45]=t("span",{class:"text-xs text-zinc-500"},"Vencimento:",-1)),u(" "+a(n.data_vencimento||"-"),1)]),t("div",Ue,[t("div",null,[e[46]||(e[46]=t("span",{class:"text-xs text-zinc-500"},"Unidade:",-1)),u(" "+a(n.unidade||n.unidade_nome||"-"),1)]),t("div",null,[e[47]||(e[47]=t("span",{class:"text-xs text-zinc-500"},"Setor:",-1)),u(" "+a(n.setor||n.setor_nome||"-"),1)])])]),e[48]||(e[48]=t("div",{class:"mt-2 text-right"},[t("button",{class:"btn btn-secondary btn-sm"},"Detalhes")],-1))]))),128))])),t("div",je,[t("div",Oe,[t("span",Ge," Exibindo "+a(Math.min((s.value-1)*x.value+1,w.value.length))+" • "+a(Math.min(s.value*x.value,w.value.length))+" de "+a(w.value.length)+" registros",1),t("div",We,[t("button",{onClick:e[16]||(e[16]=n=>s.value=1),disabled:s.value===1,class:"px-2 py-1 border rounded disabled:opacity-50"},"«",8,qe),t("button",{onClick:e[17]||(e[17]=n=>s.value=Math.max(1,s.value-1)),disabled:s.value===1,class:"px-2 py-1 border rounded disabled:opacity-50"},"‹",8,Ke),(d(!0),i(F,null,W(te.value,n=>(d(),i(F,{key:"p"+n},[n==="…"?(d(),i("span",He,"…")):(d(),i("button",{key:1,onClick:g=>s.value=n,class:p([s.value===n?"bg-blue-600 text-white border-blue-600":"","px-2 py-1 border rounded"])},a(n),11,Je))],64))),128)),t("button",{onClick:e[18]||(e[18]=n=>s.value=Math.min(C.value,s.value+1)),disabled:s.value===C.value,class:"px-2 py-1 border rounded disabled:opacity-50"},"›",8,Qe),t("button",{onClick:e[19]||(e[19]=n=>s.value=C.value),disabled:s.value===C.value,class:"px-2 py-1 border rounded disabled:opacity-50"},"»",8,Xe)])])])]))}});export{ot as default};
