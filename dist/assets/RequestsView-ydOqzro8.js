import{d as k,r as n,i as N,s as B,c as f,o as m,k as P,a as t,w as x,v as g,E as Q,z as T,t as r,F as $,B as j,D as L,u as K}from"./index-COqVfnXd.js";import{_ as O}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cce2uIDO.js";import{c as G}from"./api-DJGMUGZv.js";import{l as H}from"./http-CfBk4xsK.js";import{A as J}from"./AppConstants-096u6u1O.js";async function W(){const _=await H();return G(_.api_url)}async function X(_){const y=await W(),{data:o}=await y.get(J.API_REQUESTS,{params:_});return Array.isArray(o)?o:(o==null?void 0:o.data)||(o==null?void 0:o.rows)||[]}const Z={class:"space-y-4 p-4"},ee={class:"card p-4"},te={class:"grid grid-cols-1 md:grid-cols-6 gap-3"},se={class:"md:col-span-2"},ae={class:"md:col-span-2"},le={class:"flex items-end gap-2"},ne={class:"md:col-span-2 flex items-end justify-end text-xs text-zinc-500"},oe={class:"card"},re={key:0,class:"p-4"},de={key:1,class:"min-w-full text-left text-sm"},ue={class:"px-2 py-1"},ie={class:"px-2 py-1"},pe={class:"px-2 py-1"},ce={class:"px-2 py-1"},ve={class:"px-2 py-1"},ye={class:"px-2 py-1"},xe={class:"px-2 py-1"},fe={class:"px-2 py-1"},we=k({__name:"RequestsView",setup(_){const y=L(),o=K(),S=n([]),w=n(!1),D=n(1),Y=n(20),A=n(0),d=n(""),u=n(""),i=n(""),p=n(""),c=n(""),v=n("");function C(a,e){const s={...e||{}};return Object.keys(a||{}).forEach(l=>{a[l]?s[l]=a[l]:delete s[l]}),o.replace({query:s}).catch(()=>{}),s}function E(a){const e=new URLSearchParams,s={...a||{}};return Object.keys(s).forEach(l=>{s[l]&&e.append(l,s[l])}),e}async function R(){w.value=!0;try{const a=E(y.query);if(a.append("page",String(D.value-1)),a.append("limit",String(Y.value)),d.value&&a.append("q",d.value),u.value&&a.append("id_cliente",u.value),i.value&&a.append("id_unidade",i.value),p.value&&a.append("id_setor",p.value),c.value&&a.append("status",c.value),v.value){const s=String(v.value).split("até"),l=M=>{const b=new Date(M);if(Number.isNaN(b.getTime()))return"";const V=b.getFullYear(),F=String(b.getMonth()+1).padStart(2,"0"),I=String(b.getDate()).padStart(2,"0");return`${V}-${F}-${I}`},q=l(s[0].trim()),z=s[1]?l(s[1].trim()):q;q&&a.append("data_ini",q),z&&a.append("data_fim",z)}const e=await X(a);S.value=Array.isArray(e)?e:(e==null?void 0:e.data)||(e==null?void 0:e.rows)||[],A.value=Array.isArray(e)?e.length:(e==null?void 0:e.total)||S.value.length}finally{w.value=!1}}function U(){const a=y.query;d.value=String(a.q||""),u.value=String(a.id_cliente||""),i.value=String(a.id_unidade||""),p.value=String(a.id_setor||""),c.value=String(a.status||""),v.value=String(a.dtRange||"")}function h(){D.value=1,C({q:d.value,id_cliente:u.value,id_unidade:i.value,id_setor:p.value,status:c.value,dtRange:v.value},y.query),R()}return N(()=>{U(),R()}),B(()=>y.query,()=>{U()}),(a,e)=>(m(),f("section",Z,[P(O),t("header",ee,[t("div",te,[t("div",se,[e[7]||(e[7]=t("label",{class:"text-xs text-zinc-500"},"Busca",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),onKeyup:Q(h,["enter"]),class:"w-full rounded border px-2 py-1",placeholder:"Nome/cliente/evento"},null,544),[[g,d.value]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"text-xs text-zinc-500"},"Cliente",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>u.value=s),class:"w-full rounded border px-2 py-1",placeholder:"ID cliente"},null,512),[[g,u.value]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-xs text-zinc-500"},"Unidade",-1)),x(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),class:"w-full rounded border px-2 py-1",placeholder:"ID unidade"},null,512),[[g,i.value]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"text-xs text-zinc-500"},"Setor",-1)),x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>p.value=s),class:"w-full rounded border px-2 py-1",placeholder:"ID setor"},null,512),[[g,p.value]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"text-xs text-zinc-500"},"Status",-1)),x(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>c.value=s),class:"w-full rounded border px-2 py-1"},[...e[11]||(e[11]=[t("option",{value:""},"Todos",-1),t("option",{value:"aberta"},"Aberta",-1),t("option",{value:"fechada"},"Fechada",-1)])],512),[[T,c.value]])]),t("div",ae,[e[13]||(e[13]=t("label",{class:"text-xs text-zinc-500"},"Período (YYYY-MM-DD até YYYY-MM-DD)",-1)),x(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>v.value=s),class:"w-full rounded border px-2 py-1",placeholder:"2024-01-01 até 2024-01-31"},null,512),[[g,v.value]])]),t("div",le,[t("button",{class:"btn btn-primary",onClick:h},"Filtrar"),t("button",{class:"btn btn-secondary",onClick:e[6]||(e[6]=()=>{d.value="",u.value="",i.value="",p.value="",c.value="",v.value="",h()})},"Limpar")]),t("div",ne,r(A.value)+" registros",1)])]),t("div",oe,[w.value?(m(),f("div",re,"Carregando...")):(m(),f("table",de,[e[14]||(e[14]=t("thead",{class:"bg-zinc-100 text-xs dark:bg-zinc-800"},[t("tr",null,[t("th",{class:"px-2 py-1"},"Data"),t("th",{class:"px-2 py-1"},"Cliente"),t("th",{class:"px-2 py-1"},"Unidade"),t("th",{class:"px-2 py-1"},"Evento"),t("th",{class:"px-2 py-1"},"Setor"),t("th",{class:"px-2 py-1"},"Função"),t("th",{class:"px-2 py-1"},"Qtd"),t("th",{class:"px-2 py-1"},"Solicitante")])],-1)),t("tbody",null,[(m(!0),f($,null,j(S.value,s=>(m(),f("tr",{key:s.id,class:"border-b"},[t("td",ue,r(s.dataEvento||s.data_evento||s.data||"-"),1),t("td",ie,r(s.cliente),1),t("td",pe,r(s.unidade),1),t("td",ce,r(s.nomeEvento||s.nome_evento),1),t("td",ve,r(s.setor),1),t("td",ye,r(s.funcao),1),t("td",xe,r(s.qtdCliente||s.qtd||"-"),1),t("td",fe,r(s.solicitante),1)]))),128))])]))])]))}});export{we as default};
