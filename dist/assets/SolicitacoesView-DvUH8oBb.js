import{p as j,q as B}from"./dashboard-KDCoz-Uq.js";import{d as L,r as $,i as A,c as v,o as _,g as F,a as e,w as U,v as M,t as a,C as O,b as q,F as D,B as T,e as P,y as V,x as I,k as C,m as K}from"./index-COqVfnXd.js";import{_ as H}from"./SidePanel.vue_vue_type_script_setup_true_lang-DQWaTWup.js";import{_ as Y}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Cce2uIDO.js";import"./api-DJGMUGZv.js";import"./http-CfBk4xsK.js";import"./AppConstants-096u6u1O.js";const G={class:"flex min-w-40 flex-col"},Q=L({__name:"DashboardFilter",emits:["filter","date-change"],setup(R,{emit:c}){const i=$({client:"",unit:"",sector:"",dt_event:""}),d=c;function g(){const{client:b,unit:p,sector:m,dt_event:h}=i.value;d("filter",b,p,m,h)}return A(()=>{const b=new Date().toISOString().slice(0,10);i.value.dt_event=b,d("date-change",b)}),(b,p)=>(_(),v("form",{class:"card flex flex-wrap items-end gap-3 p-3",onSubmit:F(g,["prevent"])},[e("div",G,[p[2]||(p[2]=e("label",{class:"text-xs"},"Data",-1)),U(e("input",{"onUpdate:modelValue":p[0]||(p[0]=m=>i.value.dt_event=m),type:"date",class:"rounded-md border px-2 py-1 text-sm",onChange:p[1]||(p[1]=m=>d("date-change",i.value.dt_event))},null,544),[[M,i.value.dt_event]])]),p[3]||(p[3]=e("button",{type:"submit",class:"btn btn-primary"},"Filtrar",-1))],32))}}),W={class:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3"},J={class:"card p-3"},X={class:"text-2xl font-semibold"},Z={class:"card p-3"},ee={class:"text-2xl font-semibold"},te={class:"card p-3"},se={class:"mb-1 flex items-center justify-between text-xs text-zinc-500"},ne={class:"text-2xl font-semibold"},ae={class:"mt-2 h-2 w-full rounded bg-zinc-200 dark:bg-zinc-800"},oe={class:"card p-3"},de={class:"mb-1 flex items-center justify-between text-xs text-zinc-500"},re={class:"text-2xl font-semibold"},ie={class:"mt-2 h-2 w-full rounded bg-zinc-200 dark:bg-zinc-800"},le={class:"card p-3"},ce={class:"mb-1 flex items-center justify-between text-xs text-zinc-500"},ue={class:"text-2xl font-semibold"},pe={class:"mt-2 h-2 w-full rounded bg-zinc-200 dark:bg-zinc-800"},ve={class:"card p-3"},_e={class:"mb-1 flex items-center justify-between text-xs text-zinc-500"},ge={class:"text-2xl font-semibold"},be={class:"mt-2 h-2 w-full rounded bg-zinc-200 dark:bg-zinc-800"},me=L({__name:"DashboardCards",props:{data:{}},setup(R){function c(i){const d=Number(i||0);return isFinite(d)?Math.max(0,Math.min(100,Math.round(d))):0}return(i,d)=>{var g,b,p,m,h,z,o,r,x,f,k,w,y,S;return _(),v("div",W,[e("div",J,[d[0]||(d[0]=e("div",{class:"text-xs text-zinc-500"},"PROF. SOLICITADOS",-1)),e("div",X,a(((g=i.data)==null?void 0:g.requested_professional)??0),1)]),e("div",Z,[d[1]||(d[1]=e("div",{class:"text-xs text-zinc-500"},"CORTESIAS",-1)),e("div",ee,a(((b=i.data)==null?void 0:b.courtesy)??0),1)]),e("div",te,[e("div",se,[d[2]||(d[2]=e("span",null,"CONVITES ENVIADOS",-1)),e("span",null,a(c((p=i.data)==null?void 0:p.invitations_sent_percent))+"%",1)]),e("div",ne,a(((m=i.data)==null?void 0:m.invitations_sent)??0),1),e("div",ae,[e("div",{class:"h-2 rounded bg-brand-500",style:O({width:c((h=i.data)==null?void 0:h.invitations_sent_percent)+"%"})},null,4)])]),e("div",oe,[e("div",de,[d[3]||(d[3]=e("span",null,"CONVITES ACEITOS",-1)),e("span",null,a(c((z=i.data)==null?void 0:z.invitations_accepted_percent))+"%",1)]),e("div",re,a(((o=i.data)==null?void 0:o.invitations_accepted)??0),1),e("div",ie,[e("div",{class:"h-2 rounded bg-brand-500",style:O({width:c((r=i.data)==null?void 0:r.invitations_accepted_percent)+"%"})},null,4)])]),e("div",le,[e("div",ce,[d[4]||(d[4]=e("span",null,"TOTAL DE CHECK-INS",-1)),e("span",null,a(c((x=i.data)==null?void 0:x.total_checkin_percent))+"%",1)]),e("div",ue,a(((f=i.data)==null?void 0:f.checkin)??0),1),e("div",pe,[e("div",{class:"h-2 rounded bg-brand-500",style:O({width:c((k=i.data)==null?void 0:k.total_checkin_percent)+"%"})},null,4)])]),e("div",ve,[e("div",_e,[d[5]||(d[5]=e("span",null,"TOTAL DE CHECK-OUTS",-1)),e("span",null,a(c((w=i.data)==null?void 0:w.total_checkout_percent))+"%",1)]),e("div",ge,a(((y=i.data)==null?void 0:y.checkout)??0),1),e("div",be,[e("div",{class:"h-2 rounded bg-brand-500",style:O({width:c((S=i.data)==null?void 0:S.total_checkout_percent)+"%"})},null,4)])])])}}}),xe={class:"space-y-4"},fe={class:"grid gap-3 sm:grid-cols-2"},he={class:"card p-3"},ye={class:"text-2xl font-semibold"},ke={class:"card p-3"},we={class:"text-2xl font-semibold"},Se={class:"card p-3"},$e={class:"text-2xl font-semibold"},ze={class:"card p-3"},Ce={class:"text-2xl font-semibold"},De={class:"card p-3"},Te={class:"text-2xl font-semibold"},Ne={class:"card p-3"},Ee={class:"text-2xl font-semibold"},Oe={key:0,class:"card p-3"},Ie={class:"grid gap-2 sm:grid-cols-2 lg:grid-cols-3"},qe={key:1,class:"rounded-md border p-3 text-xs"},Le={class:"flex flex-wrap items-center justify-between gap-2 border-b p-3 text-sm"},Re={class:"flex flex-wrap gap-2 border-b p-3"},Ve=["onClick"],Ae={class:"flex flex-wrap items-center justify-between gap-2 px-3 py-2 text-xs text-zinc-600"},je={class:"flex flex-wrap items-center justify-between gap-2 px-3 pb-2 text-xs text-zinc-600"},Be={class:"overflow-auto p-3"},Fe={class:"min-w-full text-left text-sm"},Ue={class:"px-2 py-1"},Me={class:"px-2 py-1"},Pe={class:"px-2 py-1"},Ke={class:"px-2 py-1"},He={class:"px-2 py-1"},Ye={class:"rounded-md border p-3 text-xs"},Ge={class:"mt-2 overflow-auto"},Qe=L({__name:"DashboardDetails",props:{details:{},items:{},managers:{}},setup(R){const c=$(""),i=["lido","confirmado","não lido","recusado","removido","desistiu","sem vaga"],d={lido:{chip:"border-blue-300 text-blue-700 hover:bg-blue-50 dark:text-blue-300 dark:hover:bg-blue-900/20",badge:"bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-200"},confirmado:{chip:"border-green-300 text-green-700 hover:bg-green-50 dark:text-green-300 dark:hover:bg-green-900/20",badge:"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200"},"não lido":{chip:"border-zinc-300 text-zinc-700 hover:bg-zinc-50 dark:text-zinc-300 dark:hover:bg-zinc-800",badge:"bg-zinc-100 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-200"},recusado:{chip:"border-red-300 text-red-700 hover:bg-red-50 dark:text-red-300 dark:hover:bg-red-900/20",badge:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-200"},removido:{chip:"border-orange-300 text-orange-700 hover:bg-orange-50 dark:text-orange-300 dark:hover:bg-orange-900/20",badge:"bg-orange-100 text-orange-700 dark:bg-orange-900/40 dark:text-orange-200"},desistiu:{chip:"border-yellow-300 text-yellow-700 hover:bg-yellow-50 dark:text-yellow-300 dark:hover:bg-yellow-900/20",badge:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-200"},"sem vaga":{chip:"border-purple-300 text-purple-700 hover:bg-purple-50 dark:text-purple-300 dark:hover:bg-purple-900/20",badge:"bg-purple-100 text-purple-700 dark:bg-purple-900/40 dark:text-purple-200"}};function g(o){return`rounded-md border px-2 py-1 text-xs ${(d[o]||d["não lido"]).chip}`}function b(o){return`rounded-md border px-2 py-1 text-xs text-white ${{lido:"bg-blue-600 border-blue-600",confirmado:"bg-green-600 border-green-600","não lido":"bg-zinc-700 border-zinc-700",recusado:"bg-red-600 border-red-600",removido:"bg-orange-600 border-orange-600",desistiu:"bg-yellow-600 border-yellow-600","sem vaga":"bg-purple-600 border-purple-600"}[o]||"bg-zinc-700 border-zinc-700"}`}function p(o){return`inline-flex items-center rounded px-2 py-0.5 text-xs font-medium ${(d[o]||d["não lido"]).badge}`}function m(o){if(!o)return"-";try{return new Date(o).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}catch{return String(o)}}function h(o){if(!o)return"-";try{return new Date(o).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"short"})}catch{return String(o)}}function z(o,r){return((o==null?void 0:o.data)||[]).filter(x=>(x.evento_escala_prof_status||"").toLowerCase()===r).length}return(o,r)=>{var x,f,k,w,y,S,N,E;return _(),v("section",xe,[e("div",fe,[e("div",he,[r[0]||(r[0]=e("div",{class:"text-xs text-zinc-500"},"PROF. SOLICITADOS",-1)),e("div",ye,a(((x=o.details)==null?void 0:x.requested_professional)??0),1)]),e("div",ke,[r[1]||(r[1]=e("div",{class:"text-xs text-zinc-500"},"CONVITES ENVIADOS",-1)),e("div",we,a(((f=o.details)==null?void 0:f.invitations_sent)??0),1)]),e("div",Se,[r[2]||(r[2]=e("div",{class:"text-xs text-zinc-500"},"CONVITES ACEITOS",-1)),e("div",$e,a(((k=o.details)==null?void 0:k.invitations_accepted)??0),1)]),e("div",ze,[r[3]||(r[3]=e("div",{class:"text-xs text-zinc-500"},"CHECK‑IN",-1)),e("div",Ce,a(((w=o.details)==null?void 0:w.checkin)??0),1)]),e("div",De,[r[4]||(r[4]=e("div",{class:"text-xs text-zinc-500"},"CHECK‑OUT",-1)),e("div",Te,a(((y=o.details)==null?void 0:y.checkout)??0),1)]),e("div",Ne,[r[5]||(r[5]=e("div",{class:"text-xs text-zinc-500"},"CORTESIAS",-1)),e("div",Ee,a(((S=o.details)==null?void 0:S.courtesy)??0),1)])]),(N=o.managers)!=null&&N.length?(_(),v("div",Oe,[r[6]||(r[6]=e("h3",{class:"mb-2 text-sm font-medium"},"Gestores",-1)),e("ul",Ie,[(_(!0),v(D,null,T(o.managers,t=>(_(),v("li",{key:t.id,class:"rounded-md border p-2 text-sm"},a(t.name||t.nome||t.descricao),1))),128))])])):q("",!0),(E=o.items)!=null&&E.length?q("",!0):(_(),v("div",qe," Nenhum item detalhado para este filtro. ")),(_(!0),v(D,null,T(o.items,(t,n)=>(_(),v("div",{key:n,class:"card"},[e("div",Le,[e("div",null,[e("strong",null,a(t.requested),1),P(" "+a(t.nome_profissao)+" • Vagas fechadas: ",1),e("strong",null,a(t.accepted),1)]),e("small",null,"Gestor: "+a(t.nome_gestor),1)]),e("div",Re,[(_(),v(D,null,T(i,s=>e("button",{key:s,class:V(c.value===s?b(s):g(s)),onClick:l=>c.value=c.value===s?"":s},a(s)+" ("+a(z(t,s))+") ",11,Ve)),64))]),e("div",Ae,[e("div",null,"Horário: "+a(m(t.entrada))+" às "+a(m(t.saida)),1),e("div",null,"Evento: "+a(t.nome_evento),1),e("div",null,"Setor: "+a(t.nome_setor),1)]),e("div",je,[e("div",null,"Solicitante: "+a(t.nome_solicitante),1),e("div",null,"Criação: "+a(h(t.data_criacao_escala)),1)]),e("div",Be,[e("table",Fe,[r[7]||(r[7]=e("thead",{class:"bg-zinc-100 text-xs dark:bg-zinc-800"},[e("tr",null,[e("th",{class:"px-2 py-1"},"#"),e("th",{class:"px-2 py-1"},"Nome"),e("th",{class:"px-2 py-1"},"Entrada"),e("th",{class:"px-2 py-1"},"Saída"),e("th",{class:"px-2 py-1"},"Convite")])],-1)),e("tbody",null,[(_(!0),v(D,null,T((t.data||[]).filter(s=>!c.value||(s.evento_escala_prof_status||"").toLowerCase()===c.value),(s,l)=>(_(),v("tr",{key:l,class:"border-b"},[e("td",Ue,a(l+1),1),e("td",Me,a(s.nome_usuario),1),e("td",Pe,a(m(s.evento_escala_prof_check_in)),1),e("td",Ke,a(m(s.evento_escala_prof_check_out)),1),e("td",He,[e("span",{class:V(p((s.evento_escala_prof_status||"").toLowerCase()))},a(s.evento_escala_prof_status),3)])]))),128))])])])]))),128)),e("details",Ye,[r[8]||(r[8]=e("summary",{class:"cursor-pointer select-none"},"Dados recebidos (debug)",-1)),e("pre",Ge,a(o.details),1)])])}}}),We={class:"space-y-4 p-4"},Je={class:"flex flex-wrap items-center justify-between gap-2"},Xe={class:"text-lg font-semibold"},Ze={class:"text-sm text-zinc-600"},et={class:"card"},tt={class:"flex items-center justify-between border-b p-3"},st={class:"relative max-h-[50vh] overflow-auto"},nt={key:0,class:"absolute inset-0 grid place-items-center bg-white/60"},at=["onClick"],ot={class:"text-sm"},dt={class:"text-xs text-zinc-600"},rt={class:"relative"},it={key:0,class:"absolute inset-0 grid place-items-center bg-white/60 dark:bg-zinc-900/60"},bt=L({__name:"SolicitacoesView",setup(R){const c=$(!1),i=$(!1),d=$([]),g=$({}),b=$(""),p=$(new Date().toISOString().slice(0,10)),m=I(()=>{var n;const t=Number((n=g.value)==null?void 0:n.requested_professional);return!Number.isNaN(t)&&t>0?t:d.value.reduce((s,l)=>s+(l.requested||0),0)}),h=I(()=>{var n;const t=Number((n=g.value)==null?void 0:n.invitations_accepted);return!Number.isNaN(t)&&t>0?t:d.value.reduce((s,l)=>s+(l.accepted||0),0)}),z=I(()=>{const t=g.value||{},n={requested_professional:m.value,invitations_accepted:h.value};return{...n,...t,requested_professional:(t==null?void 0:t.requested_professional)??n.requested_professional,invitations_accepted:(t==null?void 0:t.invitations_accepted)??n.invitations_accepted}}),o=I(()=>{const t=x(p.value||r()),n=["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],s=t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"});return`${n[t.getDay()]}, ${s}`});function r(t=new Date){const n=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${n}-${s}-${l}`}function x(t){if(!t)return new Date;const[n,s,l]=t.split("-").map(Number);return new Date(n,(s||1)-1,l||1)}function f(t){for(const n of t)if(n!=null&&n!=="")return n}function k(t){return{client:f([t.id_cliente,t.idCliente,t.cliente_id,t.idclient]),unit:f([t.id_unidade,t.idUnidade,t.unidade_id]),sector:f([t.id_setor,t.idSetor,t.setor_id]),date:f([t.data_evento,t.data,t.date,p.value])}}function w(t){const{client:n,unit:s,sector:l,date:u}=k(t)||{};return`${n??""}-${s??""}-${l??""}-${u??""}`}async function y(t){c.value=!0;try{const n=t instanceof URLSearchParams?t:new URLSearchParams;if(!(t instanceof URLSearchParams)){const s=new Date().toISOString().slice(0,10);n.append("data_evento",s)}d.value=await j(n)}catch(n){console.warn("[solicitacoes] requests failed",n),d.value=[]}finally{c.value=!1}}async function S(t,n,s,l){i.value=!0;try{const u=new URLSearchParams;l&&u.append("data_evento",l),t!=null&&u.append("id_cliente",String(t)),n!=null&&u.append("id_unidade",String(n)),s!=null&&u.append("id_setor",String(s)),g.value=await B(u)}catch(u){console.warn("[solicitacoes] details failed",u),g.value={}}finally{i.value=!1}}function N(t,n,s,l){const u=new URLSearchParams;l&&u.append("data_evento",l),t!=null&&u.append("id_cliente",String(t)),n!=null&&u.append("id_unidade",String(n)),s!=null&&u.append("id_setor",String(s)),y(u),S(t,n,s,l)}function E(t){p.value=t}return A(y),(t,n)=>(_(),v("section",We,[C(Y),e("header",Je,[e("div",null,[e("h2",Xe,a(o.value),1),e("span",Ze,"(Solicitações: "+a(m.value)+" | Confirmados: "+a(h.value)+")",1)]),n[2]||(n[2]=e("div",{class:"text-sm text-zinc-500"},"Solicitações",-1))]),C(Q,{onFilter:N,onDateChange:E}),C(me,{data:z.value},null,8,["data"]),e("div",et,[e("div",tt,[n[3]||(n[3]=e("h3",{class:"text-sm font-medium"},"Solicitações",-1)),e("button",{class:"btn btn-primary",onClick:n[0]||(n[0]=s=>y())},"Recarregar")]),e("div",st,[c.value?(_(),v("div",nt,[...n[4]||(n[4]=[e("span",{class:"animate-pulse text-sm"},"Carregando…",-1)])])):q("",!0),e("ul",null,[(_(!0),v(D,null,T(d.value,s=>(_(),v("li",{key:s.id,class:V(["flex cursor-pointer items-center justify-between border-b p-3 hover:bg-zinc-50 dark:hover:bg-zinc-900",{"bg-brand-50 dark:bg-brand-900/20":b.value===w(s)}]),onClick:l=>{(()=>{const u=k(s);b.value=w(s),S(u.client,u.unit,u.sector,u.date)})()}},[e("div",ot,a((s==null?void 0:s.nome_comercial)||(s==null?void 0:s.name)||(s==null?void 0:s.title)||(s==null?void 0:s.event)),1),e("div",dt,"req: "+a(s.requested)+" • ok: "+a(s.accepted),1)],10,at))),128))])])]),C(H,{open:!!b.value,title:"Detalhes do evento",onClose:n[1]||(n[1]=s=>{b.value=""})},{default:K(()=>{var s,l;return[e("div",rt,[i.value?(_(),v("div",it,[...n[5]||(n[5]=[e("span",{class:"animate-pulse text-sm"},"Carregando…",-1)])])):q("",!0),C(Qe,{details:g.value,items:(s=g.value)==null?void 0:s.data,managers:(l=g.value)==null?void 0:l.managers},null,8,["details","items","managers"])])]}),_:1},8,["open"])]))}});export{bt as default};
